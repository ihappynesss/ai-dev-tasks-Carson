# Staging Environment Configuration
# Production-like environment with 20% sampled tickets for validation

# Environment
NODE_ENV=staging
ENVIRONMENT=staging

# PostgreSQL Database
POSTGRES_USER=n8n_staging
POSTGRES_PASSWORD=${STAGING_POSTGRES_PASSWORD}
POSTGRES_DB=n8n_staging
DB_TYPE=postgresdb
DB_POSTGRESDB_HOST=${STAGING_DB_HOST}
DB_POSTGRESDB_PORT=5432
DB_POSTGRESDB_DATABASE=n8n_staging
DB_POSTGRESDB_USER=n8n_staging
DB_POSTGRESDB_PASSWORD=${STAGING_POSTGRES_PASSWORD}
DB_POSTGRESDB_SSL=true

# Redis Configuration (managed service)
REDIS_HOST=${STAGING_REDIS_HOST}
REDIS_PORT=6379
REDIS_PASSWORD=${STAGING_REDIS_PASSWORD}
REDIS_DB_QUEUE=0
REDIS_DB_CACHE=1
REDIS_DB_RATELIMIT=2
REDIS_DB_FAILED=3
REDIS_TLS=true

# n8n Authentication (strong credentials)
N8N_BASIC_AUTH_ACTIVE=true
N8N_BASIC_AUTH_USER=${STAGING_N8N_USER}
N8N_BASIC_AUTH_PASSWORD=${STAGING_N8N_PASSWORD}

# n8n Configuration
N8N_HOST=${STAGING_N8N_HOST}
N8N_PORT=443
N8N_PROTOCOL=https
WEBHOOK_URL=https://${STAGING_N8N_HOST}/
N8N_ENCRYPTION_KEY=${STAGING_ENCRYPTION_KEY}

# Execution Mode (queue mode for production-style testing)
EXECUTIONS_MODE=queue
EXECUTIONS_PROCESS=main
EXECUTIONS_DATA_SAVE_ON_ERROR=all
EXECUTIONS_DATA_SAVE_ON_SUCCESS=all
EXECUTIONS_DATA_SAVE_MANUAL_EXECUTIONS=true
EXECUTIONS_DATA_PRUNE=true
EXECUTIONS_DATA_MAX_AGE=336

# Queue Configuration (enabled with 2 workers)
QUEUE_BULL_REDIS_HOST=${STAGING_REDIS_HOST}
QUEUE_BULL_REDIS_PORT=6379
QUEUE_BULL_REDIS_DB=0
QUEUE_BULL_REDIS_PASSWORD=${STAGING_REDIS_PASSWORD}
QUEUE_BULL_REDIS_TLS=true
QUEUE_HEALTH_CHECK_ACTIVE=true
QUEUE_RECOVERY_INTERVAL=60

# Timezone
GENERIC_TIMEZONE=Australia/Sydney

# Logging (info level for staging)
N8N_LOG_LEVEL=info
N8N_LOG_OUTPUT=console,file

# Features
N8N_PERSONALIZATION_ENABLED=false
N8N_VERSION_NOTIFICATIONS_ENABLED=true
N8N_TEMPLATES_ENABLED=true
N8N_METRICS=true

# Security (production-like)
N8N_SECURE_COOKIE=true
N8N_JWT_AUTH_ACTIVE=false

# Performance (moderate limits)
EXECUTIONS_TIMEOUT=900
EXECUTIONS_TIMEOUT_MAX=3600

# Staging-specific: Sample rate (20% of tickets)
STAGING_SAMPLE_RATE=0.20
STAGING_VALIDATION_MODE=true

# Webhook Configuration
WEBHOOK_TUNNEL_URL=https://${STAGING_N8N_HOST}/

# Error Handling
N8N_GRACEFUL_SHUTDOWN_TIMEOUT=30
